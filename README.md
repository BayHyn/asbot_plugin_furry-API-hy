# 趣绮梦云黑检测插件

这是一个为 AstrBot 开发的插件，用于检测并自动踢出在趣绮梦云黑平台上有不良记录的用户。

## 功能特性

- **进群自动检测**: 当新成员加入群聊时，自动检测其是否在云黑名单中
- **批量扫描**: 可以对群内所有成员进行云黑状态扫描
- **安全踢出**: 发现云黑成员后自动踢出，并可配置拒绝再次申请入群
- **防误踢机制**: 提供确认踢出机制，避免误操作
- **频率限制**: 内置API请求频率限制，避免对服务器造成过大压力
- **群组白名单**: 可配置仅在指定群中启用自动检测功能

## 安装方法

1. 在 AstrBot 管理界面中安装本插件
2. 重启 AstrBot 以加载插件

## 配置说明

在插件配置中需要设置以下配置项：

### 必需配置

- `api_key`: 趣绮梦云黑API Key
  - 请在[趣绮梦云黑平台](https://fz.qimeng.fun)申请API Key

### 可选配置

- `auto_check_whitelist`: 进群自动检测云黑功能的群白名单
  - 仅在列表中的群启用进群自动检测云黑功能
  - 留空则在所有已启用群功能中生效

## 使用方法

### 命令列表

| 命令 | 功能说明 |
|------|----------|
| `大扫除` | 扫描当前群内所有成员的云黑状态 |
| `确认踢出` | 确认踢出之前扫描发现的云黑成员 |

### 自动检测

当有新成员加入已在白名单中的群聊时，插件会自动检测该成员是否在云黑名单中。如果检测到该成员在云黑库中，则会：
1. 自动将其踢出群聊
2. 发送通知消息说明踢出原因

### 手动扫描

群管理员可以发送 `大扫除` 命令对群内所有成员进行一次全面扫描，插件会：
1. 获取群成员列表
2. 批量查询每个成员的云黑状态
3. 显示所有检测到的云黑成员信息
4. 等待管理员确认是否踢出

发送确认踢出命令后，插件会：
1. 踢出所有检测到的云黑成员
2. 显示操作结果（成功/失败数量）

## 注意事项

1. 请妥善保管您的API Key，不要泄露给他人
2. 插件有内置频率限制（20次请求/5秒），请不要尝试绕过
3. 自动踢出功能需要机器人具有管理员权限
4. 建议首次使用时先进行手动扫描，确认功能正常后再启用自动检测

## 版本更新

### v3.4.1
- 修复了API返回格式错误时的JSON解析问题
- 增强了对无效用户ID的处理能力
- 优化了批量扫描时的用户数量统计准确性

### v3.4.0
- 增加了进群自动检测云黑功能的群白名单配置
- 创建了共享的httpx.AsyncClient以优化请求速度
- 增强了API请求频率限制机制

### v3.3.0
- 初始版本，实现基本功能

## 作者信息

- 作者：furryhm
- 联系QQ：3322969592
- 项目仓库：[GitHub](https://github.com/furryHM-mrz/asbot_plugin_furry-API-hy)

## 免责声明

本插件仅提供云黑信息查询功能，不保证信息的准确性和时效性。使用本插件造成的任何后果由使用者自行承担。